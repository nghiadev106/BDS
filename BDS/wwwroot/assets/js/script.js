var objMessagePopup;$(document).ready(function(){objMessagePopup=new MessagePopup();InitForm();$('#category').on('change',function(){RealeState.LoadSubCategory($(this).val());})
$('#cbRememberPage').on("click",function(){if($("#Remember").val()=="false"){$("#Remember").val('true');$('.custom-checkbox .icon-ok').show();}else{$("#Remember").val('false');$('.custom-checkbox .icon-ok').hide();}});$('#frmRegister #chkAgree').change(function(){var objThis=$(this);if(objThis.is(":checked")){CreateMessageError($('#frmRegister #lblMessage'),"");$('#frmRegister #resgister').removeClass('disabled');objThis.attr('value','true');}
else{CreateMessageError($('#frmRegister #lblMessage'),"Bạn chưa đồng ý Nội dung quy định của Batdongsanviet.VN");$('#frmRegister #resgister').addClass('disabled');objThis.attr('value','false');}});$('#frmRegister #chkAgree').trigger('change');if($('#slide-projecthome').length){var projecthomeSwiper=new Swiper('#slide-projecthome',{pagination:{el:'.pagi-pjthome',clickable:true,},loop:true,navigation:{nextEl:'#slide-projecthome .swiper-button-next',prevEl:'#slide-projecthome .swiper-button-prev',}});}
if($('.swiper-topbanner').length){new Swiper('.swiper-topbanner',{direction:'vertical',slidesPerView:1,loop:true,autoplay:{delay:5000,disableOnInteraction:false}});}
if($('.swiper-hpnews').length){new Swiper('.swiper-hpnews',{direction:'vertical',slidesPerView:4,spaceBetween:5,loop:true,autoplay:{delay:5000,disableOnInteraction:false}});}
$(".chosen-select:not(.disable_search)").chosen();$(".disable_search").chosen({disable_search:true});if($('#cboOrders').length){$('#cboOrders').find('option[value="'+getCookie('ArrangeId')+'"]').attr('selected','selected');$("#cboOrders").trigger("chosen:updated");}
MenuFixed();$(window).scroll(function(){FuncScrollTop();});$('#scroll-up').click(function(){$('body,html').animate({scrollTop:0},688);return false;});FuncScrollTop();FuncActiveMenu();$('.more-linkcount span').click(function(){$(this).parent().remove();$('.cp-linkcount li').removeClass('hidden');});if($(".main-detail .sidebar").length){$(".main-detail .sidebar").stick_in_parent({parent:$('.main-detail')});}
$("#popup").on("click","button[type=submit]",function(e){InitFormPopup($(this).attr("id"));});$('.change-post input[name="change"]').on('click',function(){ChangePost($(this).data('id'),$(this).parent().find('select').val());});$('.change-post input[name="delete"]').on('click',function(){ChangePost($(this).data('id'),-1);});ResizeAvatarRelatedAgency();});function validateRegister(){$('#frmRegister #chkAgree').trigger('change');if($('#frmRegister input#chkAgree:checked').length>0){$('#frmRegister #btnRegister').click();}}
function InitForm(){$('button[type=reset]').click(function(){$('.field-validation-error').empty();});$('button[type=submit]').click(function(){if($('.frm-product').length){var mySplitResult=mapCtrl.getLatLng();$("#hddLatitude").val(mySplitResult.lat);$("#hddLongtitude").val(mySplitResult.lng);if(mapCtrl.isMakerDrag)
$("#hddIsMarkerDrag").val(1);else
$("#hddIsMarkerDrag").val(0);}
var form=$(this).parents('form:first');var formId=form.find('#lblMessage');if(form.valid()){form.submit(function(e){var data=form.serialize();if(this.beenSubmitted==data)
return false;else{Loading();this.beenSubmitted=data;formId.empty();$.post(form.attr('action'),data,function(response){if(form.find('#Captcha').length){RefreshCaptchar();}
if(response.Error){Loaded();CreateMessageError(formId,response.Title,response.NextAction);}
else{if($('.frm-product').length){$.ajax({type:"POST",cache:false,url:"/MyAccount/SubmitIndexing",data:{"url":'https://batdongsanviet.vn'+response.LinkDetail,"key":'key'},beforeSend:function(){},success:function(data){if(data=='ok'){$.ajax({type:"POST",cache:false,url:"/MyAccount/ProductSubmitLink/",data:{"productId":response.ProductId},beforeSend:function(){},success:function(data){Loaded();form.find('button[type="reset"]').click();objMessagePopup.NotifyAndLink(response.Title,response.Link,response.ShortLink,response.MetaFacebook);},complete:function(){}});}
else{Loaded();form.find('button[type="reset"]').click();objMessagePopup.NotifyAndLink(response.Title,response.Link,response.ShortLink,response.MetaFacebook);}},complete:function(){}});}
else{Loaded();switch(response.NextAction){case 1:form.find('button[type="reset"]').click();objMessagePopup.NotifyAndLink(response.Title,response.Link,response.ShortLink,response.MetaFacebook);break;case 2:location.href=response.Title;break;case 5:form.find('button[type="reset"]').click();CreateMessageSucces(formId,response.Title);break;case 8:objMessagePopup.NotifyAndLink(response.Title,document.location.href);break;default:CreateMessageSucces(formId,response.Title);break;}}}});return false;}});}
else{formId.empty();$('#'+form.find('.field-validation-error').first().attr('data-valmsg-for')).focus();return false;}});}
function InitFormPopup(index){var form=$('#popup form:first');if(index!=undefined){form=$('#popup #'+index).parents("form");}
var formId=form.find('#lblMessage');$(form).removeData("validator").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse($(form));if(form.valid()){form.submit(function(e){var data=form.serialize();if(this.beenSubmitted==data&&form.attr('id')!='frmFengShuiDirection')
return false;else{Loading();this.beenSubmitted=data;formId.empty();$.post(form.attr('action'),data).done(function(response){if(form.find('#Captcha').length){RefreshCaptchar();}
Loaded();if(response.Error){CreateMessageError(formId,response.Title,response.NextAction);}
else{switch(response.NextAction){case 1:ReloadPage();break;case 2:if(form.attr('id')=='frmRegister'){form[0].reset();MessageRegisterSucces();}
else{location.href=response.Title;}
break;case 4:if(form.attr('id')=='frmFengShuiDirection'){$('.fs-result').html(response.Title);}
break;case 5:form[0].reset();CreateMessageSucces(formId,response.Title);break;default:if(form.attr('id')=='frmAgencyContact'){objMessagePopup.NotifyMessage(response.Title);}
else{CreateMessageSucces(formId,response.Title);}
break;}}}).fail(function(jqXhr,textStatus,errorThrown){var msg='';if(jqXhr.status===0){msg='Not connect.\n Verify Network.';}else if(jqXhr.status==404){msg='Requested page not found. [404]';}else if(jqXhr.status==500){msg='Internal Server Error [500].';}else if(textStatus==='parsererror'){msg='Requested JSON parse failed.';}else if(textStatus==='timeout'){msg='Time out error.';}else if(textStatus==='abort'){msg='Ajax request aborted.';}else{msg='Uncaught Error.\n'+jqXhr.responseText;}
Loaded();alert(msg);});return false;}});}
else{return false;}}
function CreateMessageSucces(formId,strMessage){formId.html("<div class=\"message-successful\">"+strMessage+"</div>");}
function CreateMessageError(formId,strMessage,action){if($('#frmContact').length){objMessagePopup.NotifyMessage(strMessage);}
else if($('#frmChangeProfile').length&&action==6){$('#frmChangeProfile').find('.valid-agency').html(strMessage);}
else if($('#frmChangeProfile').length&&action==7){$('#frmChangeProfile').find('.valid-descforagency').html(strMessage);}
else if($('#frmAgencyContact').length){$('#frmAgencyContact #lblMessage').html('<div class="field-validation-error">'+strMessage+'</div>');}
else{if(strMessage!=''){$("html,body").animate({scrollTop:(formId.offset().top-120)},"slow");}
formId.html("<div class=\"field-validation-error\">"+strMessage+"</div>");}}
function PostUrlMesage(url){$.ajax({type:"POST",url:url,beforeSend:function(){Loading();},success:function(response){if(response.Error){CreateMessageError(response.Title);}
else{switch(response.NextAction){case 1:ReloadPage();break;case 2:location.href=response.Title;break;case 3:window.open("/Auto/PreviewAuto");break;case 5:form[0].reset();CreateMessageSucces(response.Title);break;default:CreateMessageSucces(response.Title);break;}}},error:function(xhr){alert("Error occured.please try again");},complete:function(){Loaded();}});}
var RealeState={LoadSubCategory:function(parentid){var html='<option value="" selected="" disabled="">Select subcategory...</option>';$('#subcategory').html(html);var bodydatakey='Product_GetSubCategory_'+parentid;var lstItems=$("body").data(bodydatakey);if(lstItems!=null&&lstItems.length>0){for(var i=0;i<lstItems.length;i++){html+='<option value="'+lstItems[i].Id+'">'+lstItems[i].Name+'</option>';}
$('#subcategory').html(html);}
else{var url="/Product/GetSubCategory";var data={parentid:parentid};$.ajax({async:false,type:"POST",url:url,data:data,beforeSend:function(){Loading();},success:function(data){if(data!=null){for(var i=0;i<data.length;i++){html+='<option value="'+data[i].Id+'">'+data[i].Name+'</option>';}
$('#subcategory').html(html);$("body").data(bodydatakey,data);}},error:function(xhr){},complete:function(){Loaded();}});}},Confirms:function(mess,url){var html='<div class="popup-bg"></div>';html+='<div class="popup-ct">';html+='<div class="content">'+mess+'</div>';html+='<div class="action">';html+='<label class="confirms-ac-ok">Đồng ý</label>';html+='<label class="confirms-ac-cancel">Hủy</label>';html+='</div>';html+='</div>';$('#popup').html(html);NoScroll();$('.confirms-ac-ok').on('click',function(){ClosePopup();PostUrlMesage(url);});$('.confirms-ac-cancel').on('click',function(){ClosePopup();});}}
function FuncProjects(){this.Init=function(){if($('#slide-tongquan').length){var pjtongquanSwiper=new Swiper('#slide-tongquan',{navigation:{nextEl:'#slide-tongquan .swiper-button-next',prevEl:'#slide-tongquan .swiper-button-prev',},loop:true,autoplay:{delay:3000,}});}
$("#aniimated-thumbnials, .aniimated-thumbnials").lightGallery({showThumbByDefault:false});$('.img-tongquan').click(function(){$('#'+$(this).attr('data-id')).click();});if($('.ul-matbang li').length>1){$('.ul-matbang li').on('click',function(){var _this=$(this);if(!_this.hasClass('active')){$('.ul-matbang li.active').removeClass('active');_this.addClass('active');$('#imgMBView').attr('src',_this.attr('data-src')).attr('title',_this.text()).attr('alt',_this.text());}})}
else if($('.ul-matbang li').length==1){$('.ul-matbang').remove();}
$('input[name="hddimgcounter"]').each(function(){$('div[data-id="imagegallery-'+$(this).attr('data-id')+'"]').append('<span class="img-counter">'+$(this).val()+' ảnh</span>');})
$('.slide-tdduan').each(function(){var _id=$(this).attr('id');new Swiper('#'+_id,{loop:true,autoplay:{delay:3000,},navigation:{nextEl:'.slide-tdduan .swiper-button-next',prevEl:'.slide-tdduan .swiper-button-prev',}});})
if($('.album-videos').length){new Swiper('.album-videos',{slidesPerView:3,spaceBetween:20,navigation:{nextEl:'.album-videos .swiper-button-next',prevEl:'.album-videos .swiper-button-prev',},});$('.album-videos .swiper-slide div').on('click',function(){var objThis=$(this);if(objThis.hasClass('active'))return;$('#frmViewVideos').attr('src',objThis.attr('data-src'));$('.album-videos .swiper-slide div').removeClass('active');objThis.addClass('active');});}}
return this;}
function MenuFixed(){if($(document).height()-$(window).height()>200){$(window).scroll(function(){var a=$("#fix_height");var b=$('.mmenu');var c=$('.ul-menu');var d=$('.postproduct');var e=$('.user-name');var f=$('.fb-like-ex');if($(window).scrollTop()>=a.offset().top){b.addClass("mmenu-fixed");d.addClass("postproduct-fixed");e.addClass("user-name-fixed");f.addClass("fb-like-ex-fixed");d.css({'right':(b.width()-c.width())/2+'px'});if(e.length){e.css({'right':(b.width()-c.width())/2+$('.postproduct').width()+20+'px'});f.css({'right':(b.width()-c.width())/2+$('.postproduct').width()+60+'px'});}
else{f.css({'right':(b.width()-c.width())/2+$('.postproduct').width()+20+'px'});}}
else{b.removeClass("mmenu-fixed");d.removeClass("postproduct-fixed");e.css({'right':''});e.removeClass("user-name-fixed");f.removeClass("fb-like-ex-fixed");}});}}
function FuncScrollTop(){if($(window).scrollTop()>0){$("#scroll-up").fadeIn("slow");}
else{$("#scroll-up").fadeOut("slow");}}
function FuncActiveMenu(){var url=document.location.pathname;if($('#hddcurrentcategorylink').length){url=$('#hddcurrentcategorylink').val();}
var objThis=null;var len=0;$('.mmenu a').each(function(){var _objThis=$(this);var href=_objThis.attr('href');if(href!='/'&&url.indexOf(href)!=-1&&href.length>len){len=href.length;objThis=_objThis;}});if(objThis!=null){objThis.parent().addClass('mn-active');if(objThis.hasClass('subcate-article')){objThis=objThis.parent().parent().parent();objThis.addClass('mn-active');objThis.parent().parent().parent().parent().addClass('mn-active');}
else if(!objThis.hasClass('cate')){objThis.parent().parent().parent().parent().parent().addClass('mn-active');}}
$('.ul-leftmenu a').each(function(){var objThis=$(this);var href=objThis.attr('href');if(href!='/'&&url.indexOf(href)!=-1){objThis.parent().addClass('mn-active');}});}
function ViewTermsOfUse(){$.ajax({type:"POST",url:'/Home/TermsOfUse',beforeSend:function(){Loading();},success:function(data){$('#popup').html(data);$('.popup-termsofuse .icon-close').on('click',function(){ClosePopup();});$('.popup-bg').on('click',function(e){if(!$('.popup-termsofuse').is(e.target)){ClosePopup();}});},complete:function(data){Loaded();NoScroll();}});}
function ScrollToHighlight(){$("html,body").animate({scrollTop:$('#homehighlight').offset().top-40},"slow");}
function MessagePopup(){this.NotifyAndLink=function(mess,link,shortLink,metaFacebook){if(metaFacebook!=undefined&&metaFacebook!=''){$('head').append(metaFacebook);}
if(shortLink!=undefined&&shortLink!=''){$.ajax({type:"POST",url:'/Product/CreateProductSocial',data:{shortLink:shortLink},beforeSend:function(){},success:function(data){var html='<div class="popup-bg"></div>';html+='<div class="popup-ct">';html+='<div class="content">'+mess+'</div>';html+='<div class="action">';html+='<label class="confirms-ac-ok">Đóng</label>';html+='</div>';html+=data;html+='</div>';$('#popup').html(html);NoScroll();$('.confirms-ac-ok').on('click',function(){document.location.href=link;});FB.XFBML.parse();},complete:function(data){}});}
else{var html='<div class="popup-bg"></div>';html+='<div class="popup-ct">';html+='<div class="content">'+mess+'</div>';html+='<div class="action">';html+='<label class="confirms-ac-ok">OK</label>';html+='</div>';html+='</div>';$('#popup').html(html);NoScroll();$('.confirms-ac-ok').on('click',function(){document.location.href=link;});}};this.NotifyMessage=function(mess){var html='<div class="popup-bg"></div>';html+='<div class="popup-ct">';html+='<div class="content">'+mess+'</div>';html+='<div class="action">';html+='<label class="confirms-ac-cancel bg-055699 white-clr">Đóng</label>';html+='</div>';html+='</div>';$('#popup').html(html);NoScroll();$('.confirms-ac-cancel').on('click',function(){ClosePopup();});};this.NotifyConfirms=function(mess){var html='<div class="popup-bg"></div>';html+='<div class="popup-ct">';html+='<div class="content">'+mess+'</div>';html+='<div class="action">';html+='<label class="confirms-ac-ok">Đồng ý</label>';html+='<label class="confirms-ac-cancel">Hủy</label>';html+='</div>';html+='</div>';$('#popup').html(html);NoScroll();$('.confirms-ac-ok').on('click',function(){ClosePopup();return true;});$('.confirms-ac-cancel').on('click',function(){ClosePopup();return false;});};return this;}
function FengShui(){this.ShowPopup=function(){$.ajax({type:"Get",url:'/FengShui/FengShuiResult',beforeSend:function(){Loading();},success:function(data){$('#popup').html(data);$('.popup-fengshui .icon-cancel-circled-1').on('click',function(){ClosePopup();});$("#frmFengShuiDirection .chosen-select").chosen();$("#frmFengShuiDirection select").on('change',function(){$('input[name="'+$(this).data('name')+'"]').val($(this).val());});},complete:function(data){Loaded();$('#scroll-up').click();}});};this.TabEvent=function(idShow,idHidden,type){if($('#'+idShow).hasClass('fs-active'))return;$('#'+idShow).addClass('fs-active');$('#'+idHidden).removeClass('fs-active');$('#btnResetFS').click();$('.fs-result').html('');$("#frmFengShuiDirection select").trigger("chosen:updated");$('#frmFengShuiDirection li[data-id="'+idShow+'"]').removeClass('h-0');$('#frmFengShuiDirection li[data-id="'+idHidden+'"]').addClass('h-0');$('#frmFengShuiDirection input[name="Type"]').val(type);};return this;}
function ChangePost(productId,cateId){$.ajax({type:"POST",url:'/Product/ChangePost',data:{productId:productId,cateId:cateId},beforeSend:function(){},success:function(data){objMessagePopup.NotifyMessage(data.Title);},complete:function(data){}});}
function GetUrlAfterRemovePaging(){var url=document.location.pathname;url=url.replace(new RegExp(/\/p([0-9])+/g),'');url=url.replace("#product-list","");return url;}
class SearchProductHaveImage{constructor(){this.Init();};Init(){var currKey=getCookie('keyhaveimage');var key=GetUrlAfterRemovePaging();if(currKey!=undefined&&currKey!=''&&currKey!=key){setCookie(currKey,'',-1);}
setCookie('keyhaveimage',key,10);var val=getCookie(key);if(val!=undefined&&val=='ok'){val='';$('.filter-image .custom-checkbox .icon-ok').show();}
else{val='ok';$('.filter-image .custom-checkbox .icon-ok').hide();}
$('.filter-image').on("click",function(){var url=GetUrlAfterRemovePaging();setCookie(url,val,3);document.location.href=url;});};};var instanceSearchProductHaveImage=new SearchProductHaveImage();function ResizeAvatarRelatedAgency(){$('.related-agency img').each(function(){var instance=$(this);var _h=instance.height();var _w=instance.width();if(_h>_w){instance.css({"width":"82px"});_h=instance.height();instance.css('top','-'+(_h-82)/2+'px');}
else{instance.css({"height":"82px"});_w=instance.width();instance.css('left','-'+(_w-82)/2+'px');}
instance.css('opacity','1');});}