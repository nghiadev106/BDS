var objSearchFunc=new SearchFunc();$(document).ready(function(){if($('#hddAreas').length&&$('#hddPrice').length){objSearchFunc.Init();}});function SearchFunc(){this.Init=function(){objSearchFunc.GetPrices($('#cboType').val());objSearchFunc.SelectedArea();$('#advsearch').click(function(){if($('#cpsearchadvanced').hasClass('h-0')){$('#cpsearchadvanced').removeClass('h-0');$('#advsearch').text('Bỏ tìm nâng cao');}
else{$('#cpsearchadvanced').addClass('h-0');$('#advsearch').text('Tìm nâng cao');}});if($('#cpsearchadvanced option[selected="selected"]').length){$('#advsearch').click();}
$("#cboCategory").trigger("chosen:updated");};this.SelectedArea=function(){var area=$('#hddAreas').val();if(area=='')return;$('#divAreaOptions ul li').removeClass('current');$('#divAreaOptions ul li[data-id='+area+']').click();};this.SelectedPrices=function(){var type=parseInt($('#cboType').val());var price=$('#hddPrice').val();if(price=='')return;$('#divPriceOptions ul li').removeClass('current');$('#divPriceOptions ul li[data-id='+price+']').click();};this.GetSubCategory=function(parentId){var jsonObj=null;if($("body").data('GetListCate_'+parentId)!=null){jsonObj=$("body").data('GetListCate_'+parentId);}
if(jsonObj==null){$.ajax({type:"POST",cache:false,url:"/Product/GetSubCategory",data:{"parentid":parentId},success:function(dataJson){jsonObj=dataJson;$("body").data('GetListCate_'+parentId,jsonObj);},timeout:5000,complete:function(){objSearchFunc.BindCategory(jsonObj);},error:function(request,status,error){}});}
else{objSearchFunc.BindCategory(jsonObj);}
objSearchFunc.GetPrices(parentId);};this.BindCategory=function(jsonObject){$("#cboCategory").find("option:gt(0)").remove();var html=$('#cboCategory').html();if(jsonObject!=undefined)
$.each(jsonObject,function(index,obj){html+='<option value="'+obj.Id+'">'+obj.Name+'</option>';});$("#cboCategory").html(html).trigger("chosen:updated");};this.ChangeCity=function(cityId){objSearchFunc.BindWards();objSearchFunc.BindStreets();objSearchFunc.BindDistrict();objSearchFunc.ChangeDistricts(cityId,0);var jsonObj=null;if($("body").data('GetListDistrict_'+cityId)!=null){jsonObj=$("body").data('GetListDistrict_'+cityId);}
if(jsonObj==null){$.ajax({type:"POST",cache:false,url:"/Product/GetDistrictsGetAllVisibleByCityID",data:{"cityID":cityId},success:function(dataJson){jsonObj=dataJson;$("body").data('GetListDistrict_'+cityId,jsonObj);},timeout:5000,complete:function(){objSearchFunc.BindDistrict(jsonObj);},error:function(request,status,error){}});}
else{objSearchFunc.BindDistrict(jsonObj);}};this.ChangeDistricts=function(cityId,districtId){objSearchFunc.BindWards();objSearchFunc.BindStreets();objSearchFunc.GetProjectsByCityAndDistricts(cityId,districtId);if(districtId>0){var jsonWards=null;if($("body").data('GetWards_'+districtId)!=null){jsonWards=$("body").data('GetWards_'+districtId);}
if(jsonWards==null){$.ajax({type:"POST",cache:false,url:"/Product/GetWardsGetAllVisibleByDistrictId",data:{"districtId":districtId},success:function(dataJson){jsonWards=dataJson;$("body").data('GetWards_'+districtId,jsonWards);},timeout:5000,complete:function(){objSearchFunc.BindWards(jsonWards);},error:function(request,status,error){}});}
else{objSearchFunc.BindWards(jsonWards);}}
else{objSearchFunc.BindWards();}
var jsonStreets=null;if($("body").data('GetStreets_'+cityId+districtId)!=null){jsonStreets=$("body").data('GetStreets_'+cityId+districtId);}
if(jsonStreets==null){$.ajax({type:"POST",cache:false,url:"/Product/GetStreetsGetAllVisibleByDistrictId",data:{"districtId":districtId,"cityCode":cityId},success:function(dataJson){jsonStreets=dataJson;$("body").data('GetStreets_'+cityId+districtId,jsonStreets);},timeout:5000,complete:function(){objSearchFunc.BindStreets(jsonStreets);},error:function(request,status,error){}});}
else{objSearchFunc.BindStreets(jsonStreets);}};this.GetProjectsByCityAndDistricts=function(cityId,districtId){var jsonObj=null;if($("body").data('GetProjectsByCityAndDistricts_'+cityId+districtId)!=null){jsonObj=$("body").data('GetProjectsByCityAndDistricts_'+cityId+districtId);}
if(jsonObj==null){$.ajax({type:"POST",cache:false,url:"/Projects/ProjectsGetByCityCodeAndDistrictId",data:{"districtId":districtId,"cityCode":cityId},success:function(dataJson){jsonObj=dataJson;$("body").data('GetProjectsByCityAndDistricts_'+cityId+districtId,jsonObj);},timeout:5000,complete:function(){objSearchFunc.BindProjects(jsonObj);},error:function(request,status,error){}});}
else{objSearchFunc.BindProjects(jsonObj);}};this.BindProjects=function(jsonObject){$("#cboProjects").find("option:gt(0)").remove();var html=$('#cboProjects').html();if(jsonObject!=undefined)
$.each(jsonObject,function(index,obj){html+='<option value="'+obj.ProjectId+'">'+obj.ProjectName+'</option>';});$("#cboProjects").html(html).trigger("chosen:updated");};this.BindStreets=function(jsonObject){$("#cboStreets").find("option:gt(0)").remove();var html=$('#cboStreets').html();if(jsonObject!=undefined)
$.each(jsonObject,function(index,obj){html+='<option value="'+obj.StreetId+'">'+obj.StreetName+'</option>';});$("#cboStreets").html(html).trigger("chosen:updated");};this.BindWards=function(jsonObject){$("#cboWards").find("option:gt(0)").remove();var html=$('#cboWards').html();if(jsonObject!=undefined)
$.each(jsonObject,function(index,obj){html+='<option value="'+obj.WardId+'">'+obj.WardName+'</option>';});$("#cboWards").html(html).trigger("chosen:updated");};this.BindDistrict=function(jsonObject){$("#cboDistricts").find("option:gt(0)").remove();var html=$('#cboDistricts').html();if(jsonObject!=undefined)
$.each(jsonObject,function(index,obj){html+='<option value="'+obj.DistrictId+'">'+obj.DistrictName+'</option>';});$("#cboDistricts").html(html).trigger("chosen:updated");};this.BindPrices=function(cateId,jsonObject){var b='<li data-id="-1" class="advance-options current">--Chọn mức giá--</li>';if(jsonObject!=undefined)
$.each(jsonObject,function(index,obj){if(cateId==obj.Type){b+='<li data-id="'+obj.Id+'" class="advance-options">'+obj.Name+"</li>"}});hdbPrice.UpdateOptions(b);};this.GetPrices=function(cateId){var bodydatakey='Product_ListAllPriceUnit';var lstItems=$("body").data(bodydatakey);if(lstItems!=null&&lstItems.length>0){objSearchFunc.BindPrices(cateId,lstItems);}
else{var url="/Product/ListAllPriceUnit";var data=null;$.ajax({async:false,type:"POST",url:url,data:data,beforeSend:function(){},success:function(data){$("body").data(bodydatakey,data);objSearchFunc.BindPrices(cateId,data);},error:function(xhr){},complete:function(){}});}};this.SubmitSearchs=function(btn){var form=$(btn).parents('form:first');form.submit(function(e){var data=form.serialize();if(this.beenSubmitted==data)
return false;else{this.beenSubmitted=data;$.ajax({type:"POST",cache:false,url:form.attr('action'),data:data,success:function(data){if(data.Link!=''){document.location.href=data.Link;}},timeout:5000,complete:function(){},error:function(request,status,error){}});return false;}});};return this;}
var hdbArea=$("#divArea").BuilderDropbox({id:"divAreaOptions",minValue:"txtAreaMinValue",maxValue:"txtAreaMaxValue",unit:"area",hddValue:"hdCboArea"});var hdbPrice=$("#divPrice").BuilderDropbox({id:"divPriceOptions",minValue:"txtPriceMinValue",maxValue:"txtPriceMaxValue",unit:"money",lblMin:"lblPriceMin",lblMax:"lblPriceMax",hddValue:"hdCboPrice"});